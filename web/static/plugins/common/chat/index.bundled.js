function e(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var u,i=e[Symbol.iterator]();!(r=(u=i.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function n(e,t,n,r,a,o,u){try{var i=e[o](u),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,a)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(a,o){var u=e.apply(t,r);function i(e){n(u,a,o,i,c,"next",e)}function c(e){n(u,a,o,i,c,"throw",e)}i(void 0)}))}}var a=function(){var n=r(regeneratorRuntime.mark((function n(a){var o,u,i,c,s,l,f,d,m,p,h,v,g,y,x,w,b,k,E;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=a.__deps__,u=a.__imports__,i=u.grommet,c=i.Box,s=i.TextInput,l=i.Button,f=i.Keyboard,d=i.Anchor,m=u.utils,p=m.React,m.lodash,h=m.icons,v=u.nodehub.NodeLink,g=o.napi,o.NodeView,y=o.iconSize,x=o.viewer,b=w=function(n){var a=n.node,o=t(p.useState([]),2),u=o[0],i=o[1],m=t(p.useState(""),2),h=m[0],y=m[1];console.log("VIEWER",x);var w=function(){var e=r(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.findNode({parentId:a.id,name:".chat"});case 2:if("error"!==(t=e.sent).status){e.next=7;break}return e.next=6,g.createNode(null,{parentId:a.id,name:".chat"});case 6:t=e.sent;case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();p.useEffect((function(){(function(){var e=r(regeneratorRuntime.mark((function e(){var t,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:return t=e.sent,console.log("chat node",t),e.next=6,g.getNodeChildren(t);case 6:return n=e.sent,console.log("message nodes",n),e.next=10,Promise.all(n.items.map(function(){var e=r(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.id,e.t1=t.name,e.next=4,g.getNode(t.sides.users.filter((function(e){return"admin"===e.role}))[0].id);case 4:return e.t2=e.sent,e.abrupt("return",{id:e.t0,text:e.t1,author:e.t2});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 10:a=e.sent,i(a);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),p.useEffect((function(){var t=function(){var t=r(regeneratorRuntime.mark((function t(n){var r,a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.type,a=n.node,console.log("chat update!",r,a),t.next=4,g.getNode(a.sides.users.filter((function(e){return"admin"===e.role}))[0].id);case 4:o=t.sent,console.log("author",o),"add"===r&&i([].concat(e(u),[{id:u.length+1,text:a.name,author:o}]));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),n=function(){var e=r(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:n=e.sent,g.subscribeToNodeChildrenUpdates(n.id,t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a=function(){var e=r(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:n=e.sent,g.unsubscribeFromNodeChildrenUpdates(n.id,t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return n(),function(){a()}}));var b=function(){var e=r(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("in submit",h),""===h){e.next=10;break}return e.next=4,w();case 4:return t=e.sent,e.next=7,g.createNode(null,{parentId:t.id,name:h,sides:{users:[{id:x.node,role:"admin"}]}});case 7:n=e.sent,console.log("new message node",n),y("");case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return p.createElement(c,{fill:!0,align:"center",justify:"center"},p.createElement(c,{overflow:"scroll",fill:!0,align:"center",background:{color:"black",opacity:"medium"},pad:"small"},u.map((function(e){return p.createElement(c,{key:e.id,fill:"horizontal",height:{min:"xsmall",max:"xsmall"},background:{color:"black",opacity:"medium"},pad:"small"},e.author.name,": ",p.createElement(v,{node:e.id},p.createElement(d,null,e.text)))}))),p.createElement(c,{direction:"row",fill:"horizontal",pad:"small",background:{color:"black",opacity:"medium"},gap:"xsmall"},p.createElement(f,{onEnter:function(e){return b()}},p.createElement(s,{autoFocus:!0,value:h,onChange:function(e){return y(e.target.value)}})),p.createElement(l,{label:"Send",onClick:function(){return b()}})))},E=k=function(e){e.node;return p.createElement(c,{fill:!0,align:"center",justify:"center"},p.createElement(h.Chat,{size:y}))},n.abrupt("return",{modes:{icon:k,preview:E,view:w,edit:b}});case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();export default a;
//# sourceMappingURL=index.bundled.js.map
